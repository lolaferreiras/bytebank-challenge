<mat-dialog-content role="dialog" aria-labelledby="login-title" aria-describedby="login-description">
  <div class="branding">
    <img class="illustration" 
         [ngSrc]="signupMode() ? 'assets/images/signup.png' : 'assets/images/signin.png'"
         width="320"
         height="240"
         [alt]="signupMode() ? 'Ilustração de cadastro' : 'Ilustração de login'"
         aria-hidden="true" />
  </div>
  <div class="login-container">
    <div class="signin-div">
      <h2 id="login-title" class="sr-only">
        {{signupMode() ? 'Criar nova conta' : 'Fazer login'}}
      </h2>
      <p id="login-description" class="login-message">
        Bem vindo! Preencha os campos abaixo para {{signupMode() ? 'criar' : 'entrar na'}} sua conta corrente.
      </p>
    </div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" role="form" aria-labelledby="login-title">
      @if(signupMode()) {
        <mat-form-field>
          <mat-label for="username-field">Nome</mat-label>
          <input
            matInput
            id="username-field"
            formControlName="username"
            required
            aria-describedby="username-error"
            [attr.aria-invalid]="form.controls.username.invalid ? 'true' : 'false'"
          />
          @if (form.controls.username.invalid && (form.controls.username.dirty || form.controls.username.touched)) {
            <mat-error id="username-error">Nome é obrigatório</mat-error>
          }
        </mat-form-field>
      }
      
      <mat-form-field>
        <mat-label for="email-field">Email</mat-label>
        <input
          matInput
          id="email-field"
          placeholder="user@example.com"
          formControlName="email"
          required
          type="email"
          aria-describedby="email-error"
          [attr.aria-invalid]="form.controls.email.invalid ? 'true' : 'false'"
        />
        @if (form.controls.email.getError('required') && (form.controls.email.dirty || form.controls.email.touched)) {
          <mat-error id="email-error">Email é obrigatório</mat-error>
        }
        @if (form.controls.email.getError('pattern') && (form.controls.email.dirty || form.controls.email.touched)) {
          <mat-error id="email-error">Por favor, informe um email válido <i>Ex.: {{"usuário@exemplo.com"}}</i></mat-error>
        }
      </mat-form-field>

      <mat-form-field>
        <mat-label for="password-field">Senha</mat-label>
        <input 
          matInput 
          id="password-field"
          [attr.type]="showPassword() ? 'text' : 'password'" 
          formControlName="password"
          aria-describedby="password-error password-requirements"
          [attr.aria-invalid]="form.controls.password.invalid ? 'true' : 'false'"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="togglePassword()"
          [attr.aria-label]="showPassword() ? 'Ocultar senha' : 'Mostrar senha'"
          [attr.aria-pressed]="showPassword() ? 'true' : 'false'"
        >
          <mat-icon aria-hidden="true">{{showPassword() ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        
        @if (signupMode() && form.controls.password.value) {
          <mat-hint id="password-strength">
            Força: <strong [style.color]="getPasswordStrengthLabel().color === 'warn' ? '#f44336' : getPasswordStrengthLabel().color === 'accent' ? '#ff9800' : '#4caf50'">
              {{getPasswordStrengthLabel().label}}
            </strong>
          </mat-hint>
        }
        
        @if (form.controls.password.invalid && (form.controls.password.dirty || form.controls.password.touched)) {
          <div id="password-error">
            @if (form.controls.password.getError('required')) {
              <mat-error>Senha é obrigatória</mat-error>
            }
            @if (signupMode()) {
              @if (form.controls.password.getError('minLength')) {
                <mat-error>Mínimo 8 caracteres</mat-error>
              }
              @if (form.controls.password.getError('uppercase')) {
                <mat-error>Deve conter ao menos uma letra maiúscula</mat-error>
              }
              @if (form.controls.password.getError('lowercase')) {
                <mat-error>Deve conter ao menos uma letra minúscula</mat-error>
              }
              @if (form.controls.password.getError('number')) {
                <mat-error>Deve conter ao menos um número</mat-error>
              }
              @if (form.controls.password.getError('special')) {
                <mat-error>Deve conter ao menos um caractere especial (!&#64;#$%^&*)</mat-error>
              }
              @if (form.controls.password.getError('noSpaces')) {
                <mat-error>Não pode conter espaços</mat-error>
              }
              @if (form.controls.password.getError('common')) {
                <mat-error>Senha muito comum, escolha outra</mat-error>
              }
              @if (form.controls.password.getError('sequence')) {
                <mat-error>Não use sequências óbvias (123, abc, etc)</mat-error>
              }
            }
          </div>
        }
      </mat-form-field>

      @if (signupMode()) {
        <mat-form-field>
          <mat-label for="confirm-password-field">Confirmar Senha</mat-label>
          <input 
            matInput 
            id="confirm-password-field"
            [attr.type]="showConfirmPassword() ? 'text' : 'password'" 
            formControlName="confirmPassword"
            aria-describedby="confirm-password-error"
            [attr.aria-invalid]="form.controls.confirmPassword.invalid ? 'true' : 'false'"
          />
          <button
            mat-icon-button
            matSuffix
            type="button"
            (click)="toggleConfirmPassword()"
            [attr.aria-label]="showConfirmPassword() ? 'Ocultar senha' : 'Mostrar senha'"
            [attr.aria-pressed]="showConfirmPassword() ? 'true' : 'false'"
          >
            <mat-icon aria-hidden="true">{{showConfirmPassword() ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>
          @if (form.controls.confirmPassword.invalid && (form.controls.confirmPassword.dirty || form.controls.confirmPassword.touched)) {
            <mat-error id="confirm-password-error">
              @if (form.controls.confirmPassword.getError('required')) {
                Confirmação de senha é obrigatória
              }
              @if (form.controls.confirmPassword.getError('passwordMismatch')) {
                As senhas não coincidem
              }
            </mat-error>
          }
        </mat-form-field>

        <div class="password-requirements" id="password-requirements">
          <small><strong>Requisitos da senha:</strong></small>
          <ul>
            <li>Mínimo 8 caracteres</li>
            <li>Uma letra maiúscula (A-Z)</li>
            <li>Uma letra minúscula (a-z)</li>
            <li>Um número (0-9)</li>
            <li>Um caractere especial (!&#64;#$%^&*)</li>
          </ul>
        </div>
      }
      <!-- <mat-checkbox class="checkbox" formControlName="agree">
        <small>
          Li e estou ciente quanto às condições de tratamento dos meus 
          dados conforme descrito na Política de Privacidade do banco.
        </small>
      </mat-checkbox>
      @if (form.controls.agree.invalid && (form.controls.agree.dirty || form.controls.agree.touched)) {
        <mat-error><small>Aceite os termos para continuar</small></mat-error>
      } -->
      <mat-dialog-actions>
        <button mat-button 
                class="action-btn cancel" 
                (click)="onCancelClick()"
                aria-label="Cancelar operação">Cancelar</button>
        <button 
          mat-button 
          cdkFocusInitial 
          class="action-btn save" 
          type="submit"
          aria-label="Confirmar operação"
        >
          {{signupMode() ? 'Criar conta' : 'Acessar'}}
        </button>
      </mat-dialog-actions>
    </form>
  </div>
</mat-dialog-content>
